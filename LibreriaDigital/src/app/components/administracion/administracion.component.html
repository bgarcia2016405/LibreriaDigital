<br>
<h1>Usuarios</h1><br>


<button type="button" class="btn btn-outline-secondary" style="margin-left: 5rem;" routerLink="/librera">Libreria</button>

<nav role="navigation" class="primary-navigation">
  <ul>
    <li><a (click)="agregarEstado('Agregar')">Agregar</a></li>
    <li><a (click)="agregarEstado('Editar')">Editar</a></li>
    <li><a (click)="agregarEstado('Eliminar')">Eliminar </a></li>
    <li><a (click)="agregarEstado('Tabla')">Tabla</a></li>
    <li><a (click)="agregarEstado('Estadisticas')">Estadisticas</a></li>
  </ul>
</nav>


<div ><br>

 <div *ngIf="state != null && state != 'Tabla' && state != 'Estadisticas'" class="card">
  <h2>{{state}}</h2>

      <div *ngIf="state != 'Agregar'">
        <select class="form-select selec" aria-label="Default select example" id="_idUser" name="_id" #_id="ngModel" [(ngModel)]="userID._id" (change)="onChage()">
        <option selected>ID-Usuario</option>
        <option *ngFor="let us of user" value="{{us._id}}">{{us.IDUser}} | {{us.usuario}} | {{us.rol}}</option>
        </select>
      </div>


  <div class="row">

    <div class="col">
      <div class="form-group">
        <label>ID-Usuario</label>
        <input type="text" id="IDUser" name="IDUser" #IDUser="ngModel" [(ngModel)]="userChange.IDUser" *ngIf="userChange != null">
        <input type="text"  *ngIf="userChange == null">
      </div>
    </div>

    <div class="col">
      <div class="form-group">
        <label>Nombre</label>
        <input type="text" id="nombres" name="nombres" #nombres="ngModel" [(ngModel)]="userChange.nombres" *ngIf="userChange != null">
        <input type="text" *ngIf="userChange == null">
      </div>
    </div>

    <div class="col">
      <div class="form-group">
        <label>Apellido</label>
        <input type="text" id="apellidos" name="apellidos" #apellidos="ngModel" [(ngModel)]="userChange.apellidos" *ngIf="userChange != null">
        <input type="text" *ngIf="userChange == null">
      </div>
    </div>

    <div class="col">
      <div class="form-group">
        <label>Usuario</label>
        <input type="text" id="usuario" name="usuario" #usuario="ngModel" [(ngModel)]="userChange.usuario" *ngIf="userChange != null">
        <input type="text" *ngIf="userChange == null">
      </div>
    </div>

    <div class="col">
      <div class="form-group">
        <label>E-Mail</label>
        <input type="email" id="eMail" name="eMail" #eMail="ngModel" [(ngModel)]="userChange.eMail" *ngIf="userChange != null">
        <input type="email"  *ngIf="userChange == null">
      </div>
    </div>

    <div class="col" *ngIf="state == 'Agregar'">
      <div class="form-group">
        <label>Contrase√±a</label>
        <input type="password" id="password" name="password" #password="ngModel" [(ngModel)]="userChange.password" *ngIf="userChange != null">
        <input type="password" id="password"  *ngIf="userChange == null">
      </div>
    </div>

    <div class="col">
      <div class="form-group">
        <label>Rol</label>
        <select class="form-select selec" aria-label="Default select example"  id="rol" name="rol" #rol="ngModel" [(ngModel)]="userChange.rol" *ngIf="userChange != null">
          <option >{{userChange.rol}}</option>
          <option value="estudiante">estudiante</option>
          <option value="bibliotecario">bibliotecario</option>
          <option value="admin">admin</option>
          </select>
          <select class="form-select selec" aria-label="Default select example"   *ngIf="userChange == null">
            <option value="estudiante">estudiante</option>
            <option value="bibliotecario">bibliotecario</option>
            <option value="admin">admin</option>
            </select>
      </div>
    </div>

    <div class="col">
      <input type="submit" value="{{state}}" (click)="stage()">
    </div>
  </div>
</div>

</div>

<div *ngIf="state == 'Tabla'">

  <table class="table table-success table-striped tt">

  <thead>

    <tr>
      <th scope="col" *ngIf="IDUserState == 'Mayor'">ID-Usuario <a (click)="ordenUsuarios('Menor')"><i class="bi bi-caret-down-fill"></i></a></th>
      <th scope="col" *ngIf="IDUserState == 'Menor'" >ID-Usuario <a (click)="ordenUsuarios('Mayor')"><i class="bi bi-caret-up-fill"></i></a></th>
      <th scope="col">Nombre</th>
      <th scope="col">Apellido</th>
      <th scope="col">Usuario</th>
      <th scope="col">E-Mail</th>
      <th scope="col">Rol</th>
      <th scope="col">Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of userTable, let i = index">
      <td>{{user.IDUser}}</td>
      <td>{{user.nombres}}</td>
      <td>{{user.apellidos}}</td>
      <td>{{user.usuario}}</td>
      <td>{{user.eMail}}</td>
      <td>{{user.rol}}</td>
      <td>
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModalLabel"><i class="bi bi-eye" (click)="buscarId(user._id)"></i></button>
        <button type="button" class="btn btn-warning" *ngIf="user.rol != 'admin'" (click)="editar(user)"><i class="bi bi-pen" (click)="editar(user)"></i></button>
        <button type="button" class="btn btn-danger"  *ngIf="user.rol != 'admin'"  (click)="eliminar(user)"><i class="bi bi-trash" (click)="eliminar(user)"></i></button>
      </td>
    </tr>
  </tbody>
</table>
</div>

<div class="modal fade " id="exampleModalLabel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" >
    <div class="modal-content" >

      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{userInfo.nombres}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <button type="button" class="btn btn-outline-secondary bOption" (click)="posesion()"><i class="bi bi-book-fill" (click)="posesion()"></i></button>
      <button type="button" class="btn btn-outline-secondary bOption" style="margin-left: 2rem;" (click)="historial()"><i class="bi bi-clock-history" (click)="historial()"></i></button>
      <br><br>

      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Bibliografia</th>
            <th scope="col">Estado</th>
            <th scope="col" *ngIf="state == 'posesion'">Accion</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bibi of tabla, let i = index">
            <th scope="row">{{i}}</th>
            <td>{{bibi.titulo}}</td>
            <td>{{bibi.estado}}</td>
            <td *ngIf="state == 'posesion'">
              <button type="button" class="btn btn-outline-success" (click)="verificacion(bibi._id)">Devolver</button>
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
      </div>

    </div>
  </div>
</div>
